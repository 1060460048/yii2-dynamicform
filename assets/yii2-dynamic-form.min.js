/**
 * yii2-dynamic-form
 *
 * A jQuery plugin to clone form elements in a nested manner, maintaining accessibility.
 *
 * @author Wanderson Bragan√ßa <wanderson.wbc@gmail.com>
 */
!function($){var pluginName="yiiDynamicForm";$.fn.yiiDynamicForm=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?($.error("Method "+e+" does not exist on jQuery.yiiDynamicForm"),!1):methods.init.apply(this,arguments)};var events={beforeClone:"beforeClone",afterClone:"afterClone",limitReached:"limitReached",afterRemove:"afterRemove"},defaults={limit:999,min:1,dynamicItems:".dynamic-items",dynamicItem:".dynamic-item",cloneButton:".clone",deleteButton:".delete",clonePosition:"after",template:!1},regex=/(.*-)(\d)(-.*)/i,methods={init:function(e){return this.each(function(){var t=$(this),i=t.data(pluginName);if(!i){var a=$.extend({},defaults,e||{});a.fields.forEach(function(e){var t=$("#"+a.formId).yiiActiveForm("find",e.id.replace("{}",0));void 0!==t&&(e.baseConfig=t)}),t.data(pluginName,{target:t,settings:a}),t.find(a.cloneButton).length&&t.on("click",a.cloneButton,function(e){e.preventDefault(),t.triggerHandler(events.beforeClone,[$(this)]),startClone(e,$(this),t)}),t.on("click",a.deleteButton,function(e){e.preventDefault(),removeItem(t,$(this))}),0===t.find(a.dynamicItem).length&&a.fields.forEach(function(e){var t=e.id.replace("{}",0);void 0!==$("#"+a.formId).yiiActiveForm("find",t)&&$("#"+a.formId).yiiActiveForm("remove",t)})}})},updateContainer:function(){var e=$(this);redoIDs(e),restoreSpecialJs(e),fixFormValidaton(e)}},startClone=function(e,t,i){var a=i.data(pluginName).settings,n=i.find(a.dynamicItem).length;n<a.limit?($toclone=$($(a.template).html()),$newclone=$toclone.clone(!1,!1),$newclone.find("input, textarea, select").each(function(){$(this).val("")}),"after"!=a.clonePosition?$(a.dynamicItems).prepend($newclone):$(a.dynamicItems).append($newclone),redoIDs(i),removeErrorCssClass($newclone),restoreSpecialJs(i),fixFormValidaton(i),i.triggerHandler(events.afterClone,$newclone)):i.triggerHandler(events.limitReached,a.limit)},fixFormValidaton=function(e){var t=e.data(pluginName).settings;$(t.dynamicItem).each(function(e){t.fields.forEach(function(i){var a=i.id.replace("{}",e),n=i.baseConfig;void 0!==n&&(n=$.extend(!0,{},n),n.id=a,n.container=".field-"+a,n.input="#"+a,n.name=i.name.replace("{}",e),n.value=$("#"+a).val(),n.status=0,"undefined"!==$("#"+t.formId).yiiActiveForm("find",a)&&$("#"+t.formId).yiiActiveForm("remove",a),$("#"+t.formId).yiiActiveForm("add",n))})})},removeItem=function(e,t){var i=e.data(pluginName).settings,a=e.find(i.dynamicItem).length;a>i.min&&($todelete=t.closest(i.dynamicItem),$todelete.remove(),redoIDs(e),restoreSpecialJs(e),fixFormValidaton(e),a>0&&i.fields.forEach(function(e){var t=e.id.replace("{}",a-1);"undefined"!==$("#"+i.formId).yiiActiveForm("find",t)&&$("#"+i.formId).yiiActiveForm("remove",t)}),e.triggerHandler(events.afterRemove))},removeErrorCssClass=function(e){e.find(".has-success").each(function(){$(this).removeClass("has-success")}),e.find(".has-error").each(function(){$(this).removeClass("has-error")})},restoreSpecialJs=function($container){var config=$container.data(pluginName).settings,$hasDatepicker=$(config.dynamicItems).find("[data-krajee-datepicker]");$hasDatepicker.length>0&&$hasDatepicker.each(function(){$(this).parent().removeData().datepicker("remove"),$(this).parent().datepicker(eval($(this).attr("data-krajee-datepicker")))});var $hasTimepicker=$(config.dynamicItems).find("[data-krajee-timepicker]");$hasTimepicker.length>0&&$hasTimepicker.each(function(){$(this).removeData().off(),$(this).parent().find(".bootstrap-timepicker-widget").remove(),$(this).unbind(),$(this).timepicker(eval($(this).attr("data-krajee-timepicker")))});var $hasMaskmoney=$(config.dynamicItems).find("[data-krajee-maskMoney]");$hasMaskmoney.length>0&&$hasMaskmoney.each(function(){$(this).parent().find("input").removeData().off();var id="#"+$(this).attr("id"),displayID=id+"-disp";$(displayID).maskMoney("destroy"),$(displayID).maskMoney(eval($(this).attr("data-krajee-maskMoney"))),$(displayID).maskMoney("mask",parseFloat($(id).val())),$(displayID).on("change",function(){var e=$(displayID).maskMoney("unmasked")[0];$(id).val(e),$(id).trigger("change")})});var $hasFileinput=$(config.dynamicItems).find("[data-krajee-fileinput]");$hasFileinput.length>0&&$hasFileinput.each(function(){$(this).fileinput(eval($(this).attr("data-krajee-fileinput")))});var $hasTouchSpin=$(config.dynamicItems).find("[data-krajee-TouchSpin]");$hasTouchSpin.length>0&&$hasTouchSpin.each(function(){$(this).TouchSpin("destroy"),$(this).TouchSpin(eval($(this).attr("data-krajee-TouchSpin")))});var $hasSpectrum=$(config.dynamicItems).find("[data-krajee-spectrum]");$hasSpectrum.length>0&&$hasSpectrum.each(function(){var id="#"+$(this).attr("id"),sourceID=id+"-source";$(sourceID).spectrum("destroy"),$(sourceID).unbind(),$(id).unbind();var configSpectrum=eval($(this).attr("data-krajee-spectrum"));configSpectrum.change=function(e){jQuery(id).val(e.toString())},$(sourceID).attr("name",$(sourceID).attr("id")),$(sourceID).spectrum(configSpectrum),$(sourceID).spectrum("set",jQuery(id).val()),$(id).on("change",function(){$(sourceID).spectrum("set",jQuery(id).val())})});var $hasDepdrop=$(config.dynamicItems).find("[data-krajee-depdrop]");$hasDepdrop.length>0&&$hasDepdrop.each(function(){$(this).removeData().off(),$(this).unbind();var configDepdrop=eval($(this).attr("data-krajee-depdrop")),inputID=$(this).attr("id"),matchID=inputID.match(regex);if(matchID&&4===matchID.length)for(index=0;index<configDepdrop.depends.length;++index){var match=configDepdrop.depends[index].match(regex);match&&4===match.length&&(configDepdrop.depends[index]=match[1]+matchID[2]+match[3])}$(this).depdrop(configDepdrop)});var $hasSelect2=$(config.dynamicItems).find("[data-krajee-select2]");$hasSelect2.length>0&&$hasSelect2.each(function(){var id=$(this).attr("id"),configSelect2=eval($(this).attr("data-krajee-select2"));$(this).select2("destroy"),$.when($("#"+id).select2(configSelect2)).done(initSelect2Loading(id)),$("#"+id).on("select2-open",function(){initSelect2DropStyle(id)}),$(this).attr("data-krajee-depdrop")&&($(this).on("depdrop.beforeChange",function(e,i,v){var configDepdrop=eval($(this).attr("data-krajee-depdrop")),loadingText=configDepdrop.loadingText?configDepdrop.loadingText:"Loading ...";$("#"+id).select2("data",{text:loadingText})}),$(this).on("depdrop.change",function(){$("#"+id).select2("val",$("#"+id).val())}))})},redoIDs=function(e){var t=e.data(pluginName).settings;e.find(t.dynamicItem).each(function(e){var t=e,i=$(this);$(this).find("*").each(function(){var a=$(this).attr("id");if(a){var n=a,r=a.match(regex);r&&4===r.length?(n=r[1]+e+r[3],$(this).attr("id",n)):(n=a+e,$(this).attr("id",n)),a!==n&&i.find(".field-"+a).each(function(){$(this).removeClass("field-"+a).addClass("field-"+n)})}var o=$(this).attr("for");if(o){var r=o.match(regex);r&&4===r.length?$(this).attr("for",r[1]+e+r[3]):$(this).attr("for",o+e)}var c=$(this).attr("name");if(c){var d=c.match(/\[([^}]+)\]/);if(d&&d.length>=1){var s=c;c=[].map.call(s,function(e,i){return isNaN(+e)||"["!==s[i-1]||"]"!==s[i+1]?e:t}).join(""),$(this).attr("name",c)}}})})}}(window.jQuery);
